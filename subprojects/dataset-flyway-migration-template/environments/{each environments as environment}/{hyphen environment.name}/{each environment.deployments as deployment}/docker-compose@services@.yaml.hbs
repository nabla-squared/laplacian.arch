{{#each (filter environment.deployments '@it.isa_db_container_deployment') as |db_deployment| ~}}
{{define 'instance_name' (concat db_deployment.instance_name '-migration') ~}}
  #
  # {{db_deployment.name}} migration task
  #
  {{instance_name}}-migration:
    build:
      context: ./{{instance_name}}
      dockerfile: Dockerfile
    container_name: {{instance_name}}
    environment:
    {{define 'prefix' (concat 'datasource.' (hyphen datasource.name) '.') ~}}
    {{printf "- '%s=%s'" (upper-snake (concat prefix 'username')) db_deployment.username}}
    {{printf "- '%s=%s'" (upper-snake (concat prefix 'password')) db_deployment.password}}
    {{printf "- '%s=%s'" (upper-snake (concat prefix 'jdbc-url')) db_deployment.jdbc_connection_string}}
    networks:
    - backend
{{/each}}